# Whisper - Typecho 微语插件

<div align="center">

![Version](https://img.shields.io/badge/version-1.0.0-blue.svg)
![Typecho](https://img.shields.io/badge/Typecho-1.0+-green.svg)
![License](https://img.shields.io/badge/license-MIT-orange.svg)

一个简洁优雅的 Typecho 微语（说说/动态）插件，让你可以在博客上发表简短的心情和想法。

[功能特点](#功能特点) • [在线演示](#在线演示) • [安装教程](#安装教程) • [使用说明](#使用说明) • [常见问题](#常见问题)

</div>

---

## 📸 预览

### 未登录状态
- 清新简洁的列表展示
- 自定义欢迎标题
- 响应式设计

### 登录状态
- 便捷的发表框
- 表情选择器
- 图片上传功能

---

## ✨ 功能特点

### 核心功能
- 📝 **发表微语** - 支持多行文本，快速记录想法
- 🖼️ **图片上传** - 支持多图上传（最多9张），单张限制5MB
- 😊 **表情选择** - 40+ 常用表情，一键插入
- ❤️ **点赞功能** - 为喜欢的微语点赞，防重复点赞
- 🗑️ **删除管理** - 管理员可删除微语
- 📄 **分页浏览** - 自动分页，流畅加载

### 界面设计
- 🎨 **清新卡片** - 现代化卡片式设计
- 🌓 **暗黑模式** - 完美适配暗黑主题
- 📱 **响应式** - 移动端友好
- ✨ **流畅动画** - 淡入、悬停等动画效果

### 图片功能
- 🔍 **灯箱预览** - 点击图片弹窗预览
- 🔎 **缩放控制** - 支持放大、缩小、重置
- ⌨️ **快捷键** - ESC 关闭预览
- 🖼️ **智能布局** - 1-9张图片自适应布局
- 📐 **固定尺寸** - 统一高度，整齐美观

### 点赞功能
- ❤️ **一键点赞** - 简洁的点赞按钮
- 🔒 **防重复** - Cookie 记录，30天内不能重复点赞
- 💓 **心跳动画** - 点赞时爱心跳动效果
- 📊 **实时统计** - 显示点赞数量

### 时间显示
- ⏰ **智能时间** - 刚刚、X分钟前、今天、昨天、星期X
- 📅 **友好格式** - 今年内省略年份，更简洁
- 🕐 **精确到分** - 显示具体时间（HH:mm）

### 设备信息
- 💻 **系统识别** - 自动识别 Windows、macOS、Linux、Android、iOS
- 📱 **设备标识** - 显示"来自 Windows 10"等信息

### 主题适配
- 🎯 **Jasmine 主题** - 完美适配 Jasmine 主题布局
- 🔧 **通用模板** - 可适配其他主题
- 🎨 **自定义样式** - 支持 CSS 自定义

---

## 🚀 安装教程

### 环境要求
- Typecho 1.0+
- PHP 5.4+
- 支持 cURL 扩展

### 安装步骤

#### 1. 下载插件
```bash
git clone https://github.com/lovisnd/Whisper.git
```

或直接下载 ZIP 文件

#### 2. 上传文件
将插件文件上传到 Typecho 插件目录：
```
/usr/plugins/Whisper/
├── Plugin.php
├── Action.php
└── README.md
```

#### 3. 上传模板
将 `whisper.php` 复制到你的主题目录：
```
/usr/themes/你的主题名/whisper.php
```

#### 4. 启用插件
1. 登录 Typecho 后台
2. 进入 **控制台 → 插件**
3. 找到"微语"插件
4. 点击 **启用**

#### 5. 创建页面
1. 进入 **撰写 → 创建独立页面**
2. 标题填写：`微语`（或其他名称）
3. 自定义模板选择：**微语**
4. 点击 **发布**

#### 6. 配置插件（可选）
进入 **插件 → 微语 → 设置**，可配置：
- 登录后页面标题
- 未登录页面标题
- 是否显示未登录标题
- 输入框提示文字
- 每页显示数量

---

## 📖 使用说明

### 发表微语

1. **登录后台**
2. **访问微语页面**
3. **输入内容**
4. **选择表情**（可选）
5. **上传图片**（可选）
6. **点击"立即发表"**

### 上传图片

- 点击 **📷 图片** 按钮
- 选择图片（支持多选）
- 等待上传完成
- 可点击 × 删除图片
- 支持格式：JPG、PNG、GIF、WebP
- 单张限制：5MB

### 查看微语

- **未登录用户**：只能查看微语列表和点赞
- **登录用户**：可以发表、点赞和删除微语
- **点击图片**：弹窗预览，支持缩放
- **点击点赞**：为喜欢的微语点赞
- **分页浏览**：使用底部分页按钮

### 点赞微语

- 点击微语底部的 ❤️ 按钮
- 点赞后按钮变红，数字增加
- 30天内不能重复点赞同一条微语
- 点赞数据保存在数据库中

### 删除微语

- 登录状态下，每条微语右下角有"删除"按钮
- 点击后确认即可删除

---

## ⚙️ 配置选项

### 插件设置

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| 登录后页面标题 | 登录状态下显示的标题 | 有什么新鲜事想告诉大家？ |
| 未登录页面标题 | 未登录状态下显示的标题 | 岁月无声，唯有文字留痕。 |
| 是否显示未登录标题 | 控制未登录标题显示 | 显示 |
| 输入框提示文字 | 发表框的占位符 | 发表您的新鲜事儿... |
| 每页显示数量 | 每页显示多少条微语 | 10 |

### 自定义样式

可以在主题的 CSS 文件中覆盖以下类名：

```css
.whisper-container    /* 容器 */
.whisper-item         /* 微语卡片 */
.whisper-content      /* 内容区域 */
.whisper-submit-btn   /* 发表按钮 */
```

---

## 🎨 主题适配

### Jasmine 主题
插件已完美适配 Jasmine 主题，包括：
- 左侧边栏
- 顶部菜单
- 右侧边栏
- 暗黑模式

### 其他主题
如需适配其他主题，修改 `whisper.php` 中的布局结构即可。

参考主题的 `page.php` 文件，保持相同的 HTML 结构。

---

## 🔌 API 接口

插件提供以下 API：

### 获取微语列表
```
GET /action/whisper?do=list&page=1
```

**响应示例：**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "content": "今天天气真好！",
      "images_array": [],
      "os_info": "Windows 10",
      "likes": 12,
      "author_name": "博主",
      "author_avatar": "https://...",
      "time_ago": "5分钟前"
    }
  ]
}
```

### 发表微语
```
POST /action/whisper?do=publish
参数：content (必需), images (可选)
```

### 点赞微语
```
GET /action/whisper?do=like&id=1
```

**响应示例：**
```json
{
  "success": true,
  "message": "点赞成功",
  "likes": 13
}
```

### 删除微语
```
GET /action/whisper?do=delete&id=1
```

### 上传图片
```
POST /action/whisper?do=upload
参数：file (必需)
```

---

## 📁 数据库结构

插件会自动创建 `typecho_whispers` 表：

| 字段 | 类型 | 说明 |
|------|------|------|
| id | int(11) | 主键 |
| content | text | 微语内容 |
| images | text | 图片地址（逗号分隔） |
| os_info | varchar(100) | 操作系统信息 |
| likes | int(11) | 点赞数 |
| created_at | int(11) | 发表时间戳 |
| user_id | int(11) | 用户ID |

---

## ❓ 常见问题

### 1. 为什么看不到发表框？
**答：** 需要先登录 Typecho 后台才能看到发表框。

### 2. 图片上传失败怎么办？
**答：** 检查以下几点：
- 图片大小是否超过 5MB
- 图片格式是否为 JPG、PNG、GIF、WebP
- `/usr/uploads/whisper/` 目录是否有写入权限

### 3. 如何修改每页显示数量？
**答：** 后台 → 插件 → 微语 → 设置 → 每页显示数量

### 4. 如何自定义样式？
**答：** 直接编辑主题目录下的 `whisper.php` 文件中的 `<style>` 部分。

### 5. 支持多用户吗？
**答：** 支持。每个登录用户都可以发表微语，但只能删除自己的微语。

### 6. 如何备份微语数据？
**答：** 备份数据库中的 `typecho_whispers` 表即可。

### 7. 卸载插件会删除数据吗？
**答：** 不会。数据表会保留，可以手动删除。

### 8. URL 中有 index.php 怎么办？
**答：** 需要配置服务器的 URL 重写规则，或在 Typecho 后台开启"地址重写功能"。

### 9. 如何防止恶意点赞？
**答：** 插件使用 Cookie 记录点赞状态，30天内不能重复点赞。如需更严格的限制，可以添加 IP 限制。

### 10. 点赞数据会丢失吗？
**答：** 不会。点赞数保存在数据库的 `likes` 字段中，永久保存。

---

## 🛠️ 开发计划

- [x] 发表微语
- [x] 图片上传
- [x] 表情选择
- [x] 图片预览（灯箱）
- [x] 分页功能
- [x] 点赞功能
- [ ] 评论功能
- [ ] 支持视频上传
- [ ] 支持 Markdown 语法
- [ ] 标签分类
- [ ] 搜索功能
- [ ] RSS 订阅
- [ ] 导出功能

---

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request！

### 开发环境
```bash
git clone https://github.com/lovisnd/Whisper.git
cd Whisper
```

### 提交规范
- feat: 新功能
- fix: 修复 bug
- docs: 文档更新
- style: 代码格式调整
- refactor: 重构
- test: 测试相关

---

## 📄 开源协议

本项目采用 [MIT License](LICENSE) 开源协议。

---

## 💖 致谢

- [Typecho](https://typecho.org/) - 优雅的博客系统
- [Jasmine](https://github.com/...) - 清新的 Typecho 主题
- 所有贡献者和使用者

---

## 📮 联系方式

- 博客：[https://blog.zhangmingrui.top](https://blog.zhangmingrui.top)
- GitHub：[https://github.com/lovisnd/Whisper](https://github.com/lovisnd/Whisper)

---


## ⭐ Star History

如果这个项目对你有帮助，请给个 Star ⭐️

---

<div align="center">

**[⬆ 回到顶部](#whisper---typecho-微语插件)**

Made with ❤️ by [Lovisnd](https://github.com/lovisnd)

</div>
